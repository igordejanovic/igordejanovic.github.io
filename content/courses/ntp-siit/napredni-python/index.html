<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Napredne tehnike programiranja u Python-u</title>
<meta name="author" content="Igor Dejanović"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../../../s/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="../../../s/reveal.js/css/theme/simple.css" id="theme"/>

<link rel="stylesheet" href="../../../s/reveal-slides.css"/>

<link rel="stylesheet" href="../../../s/highlight-styles/docco.css"/>
<link rel="stylesheet" href=""/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../../../s/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<base target="_blank">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">Napredne tehnike programiranja u Python-u</h1>
<h2 class="subtitle"></h2>
<h2 class="author">Prof. dr Igor Dejanović (<a href="mailto:igord at uns ac rs">igord at uns ac rs</a>)</h2>
<p class="date">Kreirano 2023-03-07 Tue 12:09, pritisni ESC za mapu, m za meni, Ctrl+Shift+F za pretragu</p>
</section>

<section>
<section id="slide-orge3d597b">
<h2 id="orge3d597b">Sadržaj</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#/slide-1">1. Specijalne metode</a></li>
<li><a href="#/slide-2">2. <i>Properties</i></a></li>
<li><a href="#/slide-3">3. <i>List comprehensions</i> i generatori</a></li>
<li><a href="#/slide-4">4. Deskriptori</a></li>
<li><a href="#/slide-5">5. Dekoratori(<i>Decorators</i>)</a></li>
<li><a href="#/slide-6">6. <code>functools</code> modul - podrška za funkcije višeg reda.</a></li>
<li><a href="#/slide-7">7. <code>itertools</code> modul - pomoćne funkcije za iteraciju</a></li>
<li><a href="#/slide-8">8. <code>collections</code> - high-performance container datatypes</a></li>
<li><a href="#/slide-9">9. Višestruko nasleđivanje i MRO</a></li>
<li><a href="#/slide-10">10. async/await</a></li>
<li><a href="#/slide-11">11. Metaklase</a></li>
</ul>
</div>
</section>
</section>
<section>
<section id="slide-1">
<h2 id="1"><span class="section-number-2">1.</span> Specijalne metode</h2>
<div class="outline-text-2" id="text-1">
</div>
</section>
<section id="slide-1-1">
<h3 id="1-1"><span class="section-number-3">1.1.</span> Specijalne metode</h3>
<ul>
<li>Često se zovu i <b>magične</b> metode</li>
<li>Posebno se tretiraju od strane Python interpretera tj. imaju posebnu semantiku</li>
<li>Format naziva je <code>__xxx__</code></li>
<li>Neki od primera:
<ul>
<li><code>__init__</code></li>
<li><code>__str__</code></li>
<li><code>__eq__</code></li>
<li><code>...</code></li>

</ul></li>
<li>Implementacija <b>protokola</b></li>

</ul>
</section>
<section id="slide-1-2">
<h3 id="1-2"><span class="section-number-3">1.2.</span> Iterabilni objekti</h3>
<ul>
<li><p>
Moguće ih je koristiti u npr. <code>for</code> pelji.
</p>
<div class="org-src-container">

<pre><code class="python" >  for i in iterabilni_objekat:
</code></pre>
</div></li>
<li>Poziv ugrađene funkcije <code>iter</code> nad iterabilnim objektom vraća iterator
objekat.</li>
<li>Kada je potrebna iteracija Python poziva <code>__iter__</code> metodu nad našim objektom.
Ova funkcija treba da vrati iterator objekat.</li>
<li>Iterator objekti implementiraju tzv. <code>iterator</code> protokol.
<ul>
<li><code>__next__</code> metoda &#x2013; sledeći element ili izuzetak <code>StopIteration</code> ukoliko
smo stigli do kraja.</li>

</ul></li>

</ul>
</section>
<section id="slide-1-3">
<h3 id="1-3"><span class="section-number-3">1.3.</span> Iterabilni objekti - primer</h3>
<ul>
<li><p>
Primer <code>TextXMetaModel</code> klasa <a href="https://github.com/igordejanovic/textX">textX</a> projekta.
</p>
<div class="org-src-container">

<pre><code class="python" >  def __iter__(self):
      """
      Iterate over all classes in the current namespace and imported
      namespaces.
      """

      # Current namespace
      for name in self._current_namespace:
          yield self._current_namespace[name]

      # Imported namespaces
      for namespace in \
              self._imported_namespaces[self._namespace_stack[-1]]:
          for name in namespace:
              # yield class
              yield namespace[name]
</code></pre>
</div></li>
<li>U ovom slučaju <code>__iter__</code> metoda je generator (vraća elemente sa <code>yield</code>).</li>

</ul>
</section>
<section id="slide-1-4">
<h3 id="1-4"><span class="section-number-3">1.4.</span> Provera pripadnosti kolekciji</h3>
<ul>
<li><p>
Operator <code>in</code> služi za testiranje pripadnosti:
</p>
<div class="org-src-container">

<pre><code class="python" >  if a in neka_kolekcija:
</code></pre>
</div></li>
<li><p>
Ukoliko želimo da omogućimo <code>in</code> test sa našim objektima potrebno je
definisati specijalnu metodu <code>__contains__</code>:
</p>
<div class="org-src-container">

<pre><code class="python" >  def __contains__(self, name):
      """
      Check if given name is contained in the current namespace.
      The name can be fully qualified.
      """
      try:
          self[name]
          return True
      except KeyError:
          return False
</code></pre>
</div></li>

</ul>
</section>
<section id="slide-1-5">
<h3 id="1-5"><span class="section-number-3">1.5.</span> Pristup elementu kolekcije po ključu</h3>
<ul>
<li><p>
Specijalna metoda <code>__getitem__</code> omogućava upotrebu operatora <code>[]</code>.
</p>
<div class="org-src-container">

<pre><code class="python" >  &gt;&gt;&gt; a = [1, 2, 3]
  &gt;&gt;&gt; a.__getitem__(2)
  3
  &gt;&gt;&gt; b = { "foo": 45, "bar": 34}
  &gt;&gt;&gt; b.__getitem__(34)
  ---------------------------------------------------------------------------
  KeyError                                  Traceback (most recent call last)
  ...
  KeyError: 34
  &gt;&gt;&gt; b.__getitem__("foo")
  45
</code></pre>
</div></li>

</ul>
</section>
<section id="slide-1-6">
<h3 id="1-6"><span class="section-number-3">1.6.</span> Pristup elementu kolekcije po ključu - primer</h3>
<div class="org-src-container">

<pre><code class="python" >  def __getitem__(self, name):
      """
      Search for and return class and peg_rule with the given name.
      Returns:
          TextXClass, ParsingExpression
      """
      if "." in name:
          # Name is fully qualified
          namespace, name = name.rsplit('.', 1)
          return self.namespaces[namespace][name]
      else:
          # If not fully qualified search in the current namespace
          # and after that in the imported_namespaces
          if name in self._current_namespace:
              return self._current_namespace[name]

          for namespace in \
                  self._imported_namespaces[self._namespace_stack[-1]]:
              if name in namespace:
                  return namespace[name]

          raise KeyError("{} metaclass does not exists in the metamodel "
                          .format(name))
</code></pre>
</div>
</section>
<section id="slide-1-7">
<h3 id="1-7"><span class="section-number-3">1.7.</span> Pristup atributu objekta</h3>
<ul>
<li><p>
Dve specijalne metode: <code>__getattr__</code> i <code>__getattribute__</code>
</p>
<div class="org-src-container">

<pre><code class="python" >  obj.neki_atribut
</code></pre>
</div></li>

</ul>
</section>
<section id="slide-1-8">
<h3 id="1-8"><span class="section-number-3">1.8.</span> <code>__getattr__</code></h3>
<ul>
<li><p>
Poziva se ukoliko standardnim mehanizmima nije pronađen atribut objekta. Kao
parametar prima ime atributa i vraća njegovu vrednost ukoliko postoji ili
podiže izuzetak <code>AttributeError</code> ukoliko atribut ne postoji.
</p>
<div class="org-src-container">

<pre><code class="python" >  class A:
      def __init__(self):
          self.additional = {'foo': 5, 'bar': 7.4}
          # .a će biti pronađeno standardnim mehanizmom
          self.a = 3

      def __getattr__(self, key):
          if key in self.additional:
              return self.additional[key]
          else:
              raise AttributeError

  if __name__ == '__main__':
      a = A()
      print(a.a)
      print(a.foo)
      print(a.bla)
</code></pre>
</div></li>

</ul>
</section>
<section id="slide-1-9">
<h3 id="1-9"><span class="section-number-3">1.9.</span> Postavljanje vrednosti i brisanje atributa</h3>
<ul>
<li><code>object.__setattr__(self, name, value)</code> - kada se pozove <code>object.name = value</code>
<ul>
<li>Obratiti pažnju na rekurziju! Ne raditi u telu metode <code>self.name = value</code>
već <code>self.__dict__[name] = value</code>.</li>

</ul></li>
<li><code>object.__delattr__(self, name)</code> - kada se pozove <code>del object.name</code></li>

</ul>
</section>
<section id="slide-1-10">
<h3 id="1-10"><span class="section-number-3">1.10.</span> <code>__getattribute__</code></h3>
<ul>
<li>Specijalna metoda nižeg nivoa.</li>
<li>Podrazumevana implementacija obavlja sledeću pretragu:
<ul>
<li>Prvo se proverava <code>__dict__</code> rečnik instance a zatim klasa prateći MRO lanac.</li>
<li>Ukoliko se atribut ne pronađe poziva se <code>__getattr__</code></li>

</ul></li>
<li>Ovu metodu je retko potrebno redefinisati.</li>
<li>Paziti prilikom pisanja na beskonačanu rekurziju! Najbolje je pozvati
na kraju nadimplementaciju <code>object.__getattribute__(self, name)</code></li>

</ul>
</section>
<section id="slide-1-11">
<h3 id="1-11"><span class="section-number-3">1.11.</span> Operatori</h3>
<ul>
<li>Svi operatori u Python-u su definisani specijalnim metodama. Na primer:
<ul>
<li><code>-</code> - <code>__sub__</code></li>
<li><code>+</code> - <code>__add__</code></li>
<li><code>*</code> - <code>__mul__</code></li>
<li><code>+=</code> - <code>__iadd__</code> - (za <b>mutable</b> objekte)</li>
<li>&#x2026;</li>

</ul></li>

</ul>
</section>
<section id="slide-1-12">
<h3 id="1-12"><span class="section-number-3">1.12.</span> Poređenje objekata</h3>
<ul>
<li>Ukoliko želimo da instance naše klase mogu da se porede (npr. da bi mogli da
sortiramo niz objekata) potrebno je implementirati specijalne metode:
<ul>
<li><code>__eq__</code> za operator jednakosti <code>==</code></li>
<li><code>__ne__</code> za operator nejednakosti <code>!=</code></li>
<li><code>__lt__</code> za operator <b>manje</b> - <code>&lt;</code></li>
<li><code>__le__</code> za operator <b>manje ili jednako</b> - <code>&lt;=</code></li>
<li><code>__gt__</code> za operator <b>veće</b> - <code>&gt;</code></li>
<li><code>__ge__</code> za operator <b>veće ili jednako</b> - <code>&gt;=</code></li>

</ul></li>
<li>Nije potrebno ručno definisati sve operatore jer su prirodno međuzavisni.
Python u sklopu modula <code>functools</code> nudi dekorator <code>total_ordering</code> (videti u
sekciji <code>functools</code>) koji automatski kreira nedostajuće operatore poređenja.</li>

</ul>

</section>
</section>
<section>
<section id="slide-2">
<h2 id="2"><span class="section-number-2">2.</span> <i>Properties</i></h2>
<div class="outline-text-2" id="text-2">
</div>
</section>
<section id="slide-2-1">
<h3 id="2-1"><span class="section-number-3">2.1.</span> <i>Properties</i></h3>
<ul>
<li>Tzv. kalkulisani ili izvedeni atributi.</li>
<li>Generalizacija <i>getter</i> i <i>setter</i> mehanizma.</li>
<li>Sintaksa ostaje kao kod direktnog pristupa atributu.</li>

</ul>

</section>
<section id="slide-2-2">
<h3 id="2-2"><span class="section-number-3">2.2.</span> <i>Properties</i> - primer</h3>
<div class="org-src-container">

<pre><code class="python" >    class ...:
    ...
        @property
        def full_file_name(self):
            return os.path.join(self.file_path, self.file_name)

        @full_file_name.setter
        def full_file_name(self, filename):
            path_name, file_name = os.path.split(filename)
            self.file_path = path_name
            self.file_name = file_name
            model_name, __ = os.path.splitext(file_name)
            self.name = model_name
</code></pre>
</div>

<p>
<i>Property</i> atributima se pristupa kao običnim atributima:
</p>

<div class="org-src-container">

<pre><code class="python" >obj.full_file_name = '/neka/putanja/neko_ime.ext'
</code></pre>
</div>

<ul>
<li>Objekat čuva atribute <code>file_path</code> i <code>file_name</code>.</li>
<li>Atribut <code>full_file_name</code> je izveden.</li>

</ul>

</section>
<section id="slide-2-3">
<h3 id="2-3"><span class="section-number-3">2.3.</span> <code>__setattr__</code> i <code>@property</code></h3>
<div class="org-src-container">

<pre><code class="python" >class A:
    @property
    def a(self):
        print("get")
        return 5
    @a.setter
    def a(self, val):
        print("set")

    def __setattr__(self, name, value):
        if name == 'a':
            print('setattr')
        super().__setattr__(name, value)
a = A()
a.a = 10
out = a.a
</code></pre>
</div>

<pre class="example">
setattr
set
get
</pre>
</section>
</section>
<section>
<section id="slide-3">
<h2 id="3"><span class="section-number-2">3.</span> <i>List comprehensions</i> i generatori</h2>
<div class="outline-text-2" id="text-3">
</div>
</section>
<section id="slide-3-1">
<h3 id="3-1"><span class="section-number-3">3.1.</span> <i>List comprehensions</i></h3>
<div class="column" style="float:left; width: 40%">
<div class="org-src-container">

<pre><code class="python" >nums = [1, 2, 3, 4, 5]
squares = []
for n in nums:
  squares.append(n * n)

# Ekvivalentno
nums = [1, 2, 3, 4, 5]
squares = [n * n for n in nums]
</code></pre>
</div>
</div>

<div class="column" style="float:right; width: 60%">
<div class="org-src-container">

<pre><code class="python" ># Opšti oblik sintakse
[expression for item1 in iterable1 if condition1
            for item2 in iterable2 if condition2
            ...
            for itemN in iterableN if conditionN ]

# Što je ekvivalentno sa
s = []
for item1 in iterable1:
  if condition1:
    for item2 in iterable2:
      if condition2:
        ...
        for itemN in iterableN:
          if conditionN: s.append(expression)
</code></pre>
</div>
</div>

</section>
<section id="slide-3-2">
<h3 id="3-2"><span class="section-number-3">3.2.</span> <i>List comprehensions</i> primeri</h3>
<div class="org-src-container">

<pre><code class="python" >a = [-3, 5, 2, -10, 7, 8]
b = 'abc'

c = [2*s for s in a]                # c = [-6,10,4,-20,14,16]
d = [s for s in a if s &gt;= 0]        # d = [5,2,7,8]
e = [(x, y) for x in a              # e = [(5,'a'),(5,'b'),(5,'c'),
           for y in b               #      (2,'a'),(2,'b'),(2,'c'),
           if x &gt; 0 ]               #      (7,'a'),(7,'b'),(7,'c'),
                                    #      (8,'a'),(8,'b'),(8,'c')]

f = [(1,2), (3,4), (5,6)]
g = [math.sqrt(x * x + y * y)       # g = [2.23606, 5.0, 7.81024]
     for x, y in f]
</code></pre>
</div>

</section>
<section id="slide-3-3">
<h3 id="3-3"><span class="section-number-3">3.3.</span> Generator izrazi</h3>
<p>
Slično kao <i>list comprehensions</i> ali ne kreiraju listu već generator objekat
koji izračunava vrednosti na zahtev (lenja evaluacija).
</p>

<div class="column" style="float:left; width: 60%">
<div class="org-src-container">

<pre><code class="python" ># Opšti oblik sintakse
(expression for item1 in iterable1 if condition1
            for item2 in iterable2 if condition2
            ...
            for itemN in iterableN if conditionN )
</code></pre>
</div>
</div>

<div class="column" style="float:right; width: 40%">
<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; a = [1, 2, 3, 4]
&gt;&gt;&gt; b = (10*i for i in a)
&gt;&gt;&gt; b
&lt;generator object at 0x590a8&gt;
&gt;&gt;&gt; b.next()
10
&gt;&gt;&gt; b.next()
20
...
</code></pre>
</div>
</div>

</section>
<section id="slide-3-4">
<h3 id="3-4"><span class="section-number-3">3.4.</span> Generator izrazi - primer</h3>
<div class="org-src-container">

<pre><code class="python" >f = open("data.txt")
lines = (t.strip() for t in f)

comments = (t for t in lines if t[0] == '#')
for c in comments:
  print(c)

# Uvek se može konvertovati u listu
clist = list(comments)
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-4">
<h2 id="4"><span class="section-number-2">4.</span> Deskriptori</h2>
<div class="outline-text-2" id="text-4">
</div>
</section>
<section id="slide-4-1">
<h3 id="4-1"><span class="section-number-3">4.1.</span> <i>Descriptors</i></h3>
<ul>
<li>Generalizacija prilagođavanja pristupu atributima objekata.</li>
<li>Npr. <i>properties</i> iz prethodne sekcije su implementirani mehanizmom
deskriptora.</li>
<li>Ukoliko interpreter pronađe atribut na nivou klase i taj atribut je objekat
koji ima neku od metoda <code>__get__</code>, <code>__set__</code>, <code>__del__</code> tada će ovim metodama
biti prosleđeno dobavljanje, postavljanje ili brisanje atributa respektivno.</li>

</ul>

</section>
<section id="slide-4-2">
<h3 id="4-2"><span class="section-number-3">4.2.</span> Problem sa <i>properties</i></h3>
<div class="org-src-container">

<pre><code class="python" >class Order:
    def __init__(self, name, price, quantity):
        self._name = name
        self.price = price
        self._quantity = quantity

    @property
    def quantity(self):
        return self._quantity

    @quantity.setter
    def quantity(self, value):
        if value &lt; 0:
            raise ValueError('Cannot be negative.')
        self._quantity = value

    def total(self):
        return self.price * self.quantity

apple_order = Order('apple', 1, 10)
print(apple_order.total())
try:
    apple_order.quantity = -10
except ValueError as e:
    print('Woops:', str(e))
</code></pre>
</div>

<pre class="example">
10
Woops: Cannot be negative.
</pre>


<p class="footer" style="clear: both;">
<a href="https://dev.to/dawranliou/writing-descriptors-in-python-36" class="footer" style="clear: both;">https://dev.to/dawranliou/writing-descriptors-in-python-36</a>
</p>

</section>
<section id="slide-4-3">
<h3 id="4-3"><span class="section-number-3">4.3.</span> Rešenje upotrebom deskriptora (1)</h3>
<div class="org-src-container">

<pre><code class="python" >   class NonNegative:
   
    def __get__(self, instance, owner):
        return instance.__dict__[self.name]
        
    def __set__(self, instance, value):
        if value &lt; 0:
            raise ValueError('Cannot be negative.')
        instance.__dict__[self.name] = value
        
    def __set_name__(self, owner, name):
        self.name = name
</code></pre>
</div>

<ul class="footer" style="clear: both;">
<li><a href="https://dev.to/dawranliou/writing-descriptors-in-python-36">https://dev.to/dawranliou/writing-descriptors-in-python-36</a></li>
<li><a href="https://docs.python.org/3/howto/descriptor.html">https://docs.python.org/3/howto/descriptor.html</a></li>

</ul>

</section>
<section id="slide-4-4">
<h3 id="4-4"><span class="section-number-3">4.4.</span> Rešenje upotrebom deskriptora (2)</h3>
<div class="org-src-container">

<pre><code class="python" >   class Order:
   
      price = NonNegative()
      quantity = NonNegative()

      def __init__(self, name, price, quantity):
          self._name = name
          self.price = price
          self.quantity = quantity

      def total(self):
          return self.price * self.quantity
        
   apple_order = Order('apple', 1, 10)
   print(apple_order.total())
    
   try:
       apple_order.quantity = -10
   except ValueError as e:
       print('Woops:', str(e))
</code></pre>
</div>

<pre class="example">
10
Woops: Cannot be negative.
</pre>


<p class="footer" style="clear: both;">
<a href="https://dev.to/dawranliou/writing-descriptors-in-python-36" class="footer" style="clear: both;">https://dev.to/dawranliou/writing-descriptors-in-python-36</a>
</p>

</section>
</section>
<section>
<section id="slide-5">
<h2 id="5"><span class="section-number-2">5.</span> Dekoratori(<i>Decorators</i>)</h2>
<div class="outline-text-2" id="text-5">
</div>
</section>
<section id="slide-5-1">
<h3 id="5-1"><span class="section-number-3">5.1.</span> Dekoratori</h3>
<ul>
<li>Dekorator obrazac.</li>
<li><p>
Funkcije koje prihvataju kao parametar funkciju (ili uopšte <code>callable</code>) i
vraćaju izmenjenu verziju.
</p>

<div class="org-src-container">

<pre><code class="python" >  @trace
  def square(x):
    return x*x

  # Ovo je ekvivalentno sa
  def square(x):
    return x*x
  square = trace(square)
</code></pre>
</div>

<div class="org-src-container">

<pre><code class="python" >  enable_tracing = True
  if enable_tracing:
    debug_log = open("debug.log","w")
  def trace(func):
    if enable_tracing:
      def callf(*args,**kwargs):
        debug_log.write("Calling %s: %s, %s\n" %
                (func._ _name_ _, args, kwargs))
        r = func(*args,**kwargs)
        debug_log.write("%s returned %s\n" %
                        (func._ _name, r))
        return r
      return callf
    else:
      return func
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-5-2">
<h3 id="5-2"><span class="section-number-3">5.2.</span> Dekoratori (2)</h3>
<p>
Mogu da se stekuju.
</p>

<div class="org-src-container">

<pre><code class="python" >@foo
@bar
@spam
def grok(x):
  pass
</code></pre>
</div>

<p>
je isto što i
</p>

<div class="org-src-container">

<pre><code class="python" >def grok(x):
  pass
grok = foo(bar(spam(grok)))
</code></pre>
</div>

</section>
<section id="slide-5-3">
<h3 id="5-3"><span class="section-number-3">5.3.</span> Dekoratori (3)</h3>
<p>
Mogu da imaju parametre.
</p>

<div class="org-src-container">

<pre><code class="python" >@eventhandler('BUTTON')
def handle_button(msg):
  ...

@eventhandler('RESET')
def handle_reset(msg):
  ...

# Sto je ekvivalentno sa
def handle_button(msg):
...
temp = eventhandler('BUTTON')
handle_button = temp(handle_button)
</code></pre>
</div>

<div class="org-src-container">

<pre><code class="python" ># Event handler decorator
event_handlers = { }
def eventhandler(event):
  def register_function(f):
    event_handlers[event] = f
    return f
  return register_function
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-6">
<h2 id="6"><span class="section-number-2">6.</span> <code>functools</code> modul - podrška za funkcije višeg reda.</h2>
<div class="outline-text-2" id="text-6">
</div>
</section>
<section id="slide-6-1">
<h3 id="6-1"><span class="section-number-3">6.1.</span> <code>partial</code></h3>
<ul>
<li>Delimična (parcijalna) primena funkcije.</li>
<li>Određeni parametri se <b>zamrzavaju</b>. Nova funkcija prihvata manji broj
parametara.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; from functools import partial
&gt;&gt;&gt; basetwo = partial(int, base=2)
&gt;&gt;&gt; basetwo.__doc__ = 'Konverzija stringa broja u bazi 2 u int.'
&gt;&gt;&gt; basetwo('10010')
18

&gt;&gt;&gt; stepen = lambda a, b: a ** b
&gt;&gt;&gt; kvadrat = partial(stepen, b=2)
&gt;&gt;&gt; kvadrat(5)
25
&gt;&gt;&gt; kub = partial(stepen, b=3)
&gt;&gt;&gt; kub(5)
125

&gt;&gt;&gt; from operator import mul
&gt;&gt;&gt; dvaputa = partial(mul, 2)
&gt;&gt;&gt; dvaputa(10)
20
&gt;&gt;&gt; triputa = partial(mul, 3)
&gt;&gt;&gt; triputa(5)
15
</code></pre>
</div>

</section>
<section id="slide-6-2">
<h3 id="6-2"><span class="section-number-3">6.2.</span> <code>reduce</code></h3>
<ul>
<li>Primena date funkcije koja prima dva parametra na iterabilnu kolekciju s leva
na desno tako što se kao prvi parametar koristi rezultat prethodne evaluacije
dok se kao drugi parametar koristi sledeći element kolekcije.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >reduce(lambda x, y: x+y, [1, 2, 3, 4, 5])
</code></pre>
</div>

<p>
izračunava
</p>

<pre>
(((1+2)+3)+4)+5)
</pre>

<ul>
<li>Postoji i kao ugrađena (<b>build-in</b>) funkcija u Python 2.</li>

</ul>

</section>
<section id="slide-6-3">
<h3 id="6-3"><span class="section-number-3">6.3.</span> <code>reduce</code> ekvivalentan Python kod</h3>
<div class="org-src-container">

<pre><code class="python" >def reduce(function, iterable, initializer=None):
    it = iter(iterable)
    if initializer is None:
        try:
            initializer = next(it)
        except StopIteration:
            raise TypeError('reduce() of empty sequence with no initial value')
    accum_value = initializer
    for x in it:
        accum_value = function(accum_value, x)
    return accum_value
</code></pre>
</div>

</section>
<section id="slide-6-4">
<h3 id="6-4"><span class="section-number-3">6.4.</span> Primer: množenje niza elemenata</h3>
<div class="org-src-container">

<pre><code class="python" >niz = range(1, 10)
</code></pre>
</div>

<p>
<code>for</code> petlja:
</p>

<div class="org-src-container">

<pre><code class="python" >proizvod = 1
for elem in niz:
    proizvod *= elem
</code></pre>
</div>

<p>
<code>reduce</code>:
</p>

<div class="org-src-container">

<pre><code class="python" >proizvod = reduce(lambda x, y: x*y, niz)
</code></pre>
</div>

</section>
<section id="slide-6-5">
<h3 id="6-5"><span class="section-number-3">6.5.</span> Kreiranje funkcije za množenje niza elemenata</h3>
<p>
Kompozicija funkcija <code>partial</code> + <code>reduce</code> (funkcionalno):
</p>
<div class="org-src-container">

<pre><code class="python" >from functools import reduce, partial
amul = partial(reduce, lambda x, y: x*y)
# ili upotrebom mul operatora
from operator import mul
amul = partial(reduce, mul)
</code></pre>
</div>

<p>
Sa <code>for</code> petljom (imperativno):
</p>
<div class="org-src-container">

<pre><code class="python" >def amul(niz):
  proizvod = 1
  for elem in niz:
      proizvod *= elem
  return proizvod
</code></pre>
</div>

<p>
Oba primera kreiraju funkciju <code>amul</code> koja množi elemente prosleđenog iterabilnog
objekta:
</p>

<div class="org-src-container">

<pre><code class="python" >amul(range(1, 100))
</code></pre>
</div>

</section>
<section id="slide-6-6">
<h3 id="6-6"><span class="section-number-3">6.6.</span> <code>update_wrapper</code> i <code>wraps</code></h3>
<ul>
<li>Kod dekoracije funkcija ažurira dekorisanu funkciju da spolja &ldquo;izgleda&rdquo; kao
originalna.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; from functools import wraps
&gt;&gt;&gt; def my_decorator(f):
...     @wraps(f)
...     def wrapper(*args, **kwds):
...         print 'Calling decorated function'
...         return f(*args, **kwds)
...     return wrapper
...
&gt;&gt;&gt; @my_decorator
... def example():
...     """Docstring"""
...     print 'Called example function'
...
&gt;&gt;&gt; example()
Calling decorated function
Called example function
&gt;&gt;&gt; example.__name__
'example'
&gt;&gt;&gt; example.__doc__
'Docstring'
</code></pre>
</div>

</section>
<section id="slide-6-7">
<h3 id="6-7"><span class="section-number-3">6.7.</span> <code>total_ordering</code></h3>
<ul>
<li>&ldquo;Dopuna&rdquo; specijalnih metoda za poređenje. Koristi se kao dekorator klase.</li>
<li>Klasa treba da definiše jednu od <code>__lt__</code>, <code>__le__</code>, <code>__gt__</code>, ili <code>__ge__()</code>
metoda uz <code>__eq__</code>.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >@total_ordering
class Student:
    def _is_valid_operand(self, other):
        return (hasattr(other, "lastname") and
                hasattr(other, "firstname"))
    def __eq__(self, other):
        if not self._is_valid_operand(other):
            return NotImplemented
        return ((self.lastname.lower(), self.firstname.lower()) ==
                (other.lastname.lower(), other.firstname.lower()))
    def __lt__(self, other):
        if not self._is_valid_operand(other):
            return NotImplemented
        return ((self.lastname.lower(), self.firstname.lower()) &lt;
                (other.lastname.lower(), other.firstname.lower()))
</code></pre>
</div>

<p class="footer" style="clear: both;">
<a href="https://docs.python.org/3/library/functools.html" class="footer" style="clear: both;">https://docs.python.org/3/library/functools.html</a>
</p>
</section>
<section id="slide-6-8">
<h3 id="6-8"><span class="section-number-3">6.8.</span> <i>Least recently used (LRU)</i> keš</h3>
<p>
Keširanje povratne vrednosti funkcije u cilju optimizacije sporijih funkcija.
</p>

<div class="org-src-container">

<pre><code class="python" >@lru_cache(maxsize=32)
def get_pep(num):
    'Retrieve text of a Python Enhancement Proposal'
    resource = 'https://www.python.org/dev/peps/pep-%04d/' % num
    try:
        with urllib.request.urlopen(resource) as s:
            return s.read()
    except urllib.error.HTTPError:
        return 'Not Found'

&gt;&gt;&gt; for n in 8, 290, 308, 320, 8, 218, 320, 279, 289, 320, 9991:
...     pep = get_pep(n)
...     print(n, len(pep))

&gt;&gt;&gt; get_pep.cache_info()
CacheInfo(hits=3, misses=8, maxsize=32, currsize=8)
</code></pre>
</div>

<p class="footer" style="clear: both;">
<a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)" class="footer" style="clear: both;">https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)</a>
</p>

</section>
</section>
<section>
<section id="slide-7">
<h2 id="7"><span class="section-number-2">7.</span> <code>itertools</code> modul - pomoćne funkcije za iteraciju</h2>
<div class="outline-text-2" id="text-7">
</div>
</section>
<section id="slide-7-1">
<h3 id="7-1"><span class="section-number-3">7.1.</span> <code>chain</code></h3>
<ul>
<li>Iteracije kroz više iterabilnih objekata prema zadatom redosledu.</li>
<li>Tretiranje niza sekvenci kao jedne sekvence.</li>

<li><p>
Upotreba:
</p>

<div class="org-src-container">

<pre><code class="python" >    from itertools import chain
    a = [1, 2, 3]
    b = 'abc'
    for i in chain(a, b):
        print(i, end=' ')
</code></pre>
</div>

<pre class="example">
1 2 3 a b c
</pre></li>

<li><p>
Ekvivalentno sa sledećim Python kodom:
</p>

<div class="org-src-container">

<pre><code class="python" >    def chain(*iterables):
        for it in iterables:
            for element in it:
                yield element
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-2">
<h3 id="7-2"><span class="section-number-3">7.2.</span> <code>cycle</code></h3>
<ul>
<li>Beskonačna iteracija kroz zadati iterabilni objekat <b>u krug</b>.</li>

<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    from itertools import cycle, islice
    return list(islice(cycle('ABCD'), 10))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-left">B</td>
<td class="org-left">C</td>
<td class="org-left">D</td>
<td class="org-left">A</td>
<td class="org-left">B</td>
<td class="org-left">C</td>
<td class="org-left">D</td>
<td class="org-left">A</td>
<td class="org-left">B</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def cycle(iterable):
        saved = []
        for element in iterable:
            yield element
            saved.append(element)
        while saved:
            for element in saved:
                yield element
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-3">
<h3 id="7-3"><span class="section-number-3">7.3.</span> <code>filter</code></h3>
<ul>
<li>Kreira iterator koji filtrira i vraća samo one elemente zadatog iterabilnog
objekta koji zadovoljavaju određeni predikat.</li>
<li>U Python 2 <code>ifilter</code> radi kao generator dok <code>filter</code> radi kao obična funkcija.</li>

<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    return list(filter(lambda x: x % 2, range(10)))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">5</td>
<td class="org-right">7</td>
<td class="org-right">9</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def filter(predicate, iterable):
        if predicate is None:
            predicate = bool
        for x in iterable:
            if predicate(x):
                yield x
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-4">
<h3 id="7-4"><span class="section-number-3">7.4.</span> <code>map</code></h3>
<ul>
<li>Kreira iterator koji vraća vrednost zadate funkcije gde se parametri zadate
funkcije uzimaju iz datih iterabilnih objekata.</li>
<li>U Python 2 <code>imap</code> radi kao generator dok <code>map</code> radi kao obična funkcija.</li>

<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    return list(map(pow, (2, 3, 10), (5, 2, 3)))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">32</td>
<td class="org-right">9</td>
<td class="org-right">1000</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def map(function, *iterables):
        iterables = [iter(x) for x in iterables]
        while True:
            try:
                args = [next(it) for it in iterables]
            except StopIteration:
                break
            if function is None:
                yield tuple(args)
            else:
                yield function(*args)
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-5">
<h3 id="7-5"><span class="section-number-3">7.5.</span> <code>zip</code></h3>
<ul>
<li>Kreira iterator koji istovremeno iterira kroz više iterabilnih objekata
vraćajući n-torke gde svaki element pripada odgovarajućem iterabilnom objektu.</li>
<li>U Python 2 <code>izip</code> radi kao generator dok <code>zip</code> radi kao obična funkcija.</li>

<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    return list(zip('ABCD', 'xy'))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-left">x</td>
</tr>

<tr>
<td class="org-left">B</td>
<td class="org-left">y</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def zip(*iterables):
        iterators = map(iter, iterables)
        while iterators:
            yield tuple(map(next, iterators))
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-6">
<h3 id="7-6"><span class="section-number-3">7.6.</span> <code>groupby</code></h3>
<ul>
<li>Kreira iterator koji vraća grupe elemenata prema zadatoj <code>key</code> funkciji.</li>
<li>Kolekcija nad kojom pozivamo <code>groupby</code> mora biti sortirana prema istoj <code>key</code>
funkciji.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >groups = []
uniquekeys = []
data = sorted(data, key=keyfunc)
for k, g in groupby(data, keyfunc):
    groups.append(list(g))
    uniquekeys.append(k)
</code></pre>
</div>

</section>
<section id="slide-7-7">
<h3 id="7-7"><span class="section-number-3">7.7.</span> <code>dropwhile</code></h3>
<ul>
<li>Iterator koji odbacuje prve elemente za koje je dati predikat istinit i zatim
vraća sve preostale redom.</li>

<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    from itertools import dropwhile
    return list(dropwhile(lambda x: x &lt; 5, [1, 4, 6, 4, 1]))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">6</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def dropwhile(predicate, iterable):
        iterable = iter(iterable)
        for x in iterable:
            if not predicate(x):
                yield x
                break
        for x in iterable:
            yield x
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-8">
<h3 id="7-8"><span class="section-number-3">7.8.</span> <code>takewhile</code></h3>
<ul>
<li>Iterator koji vraća elemente dok je predikat zadovoljen.</li>
<li><p>
Primer:
</p>

<div class="org-src-container">

<pre><code class="python" >    from itertools import takewhile
    return list(takewhile(lambda x: x &lt; 5, [1, 4, 6, 4, 1]))
</code></pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table></li>

<li><p>
Ekvivalentno sa:
</p>

<div class="org-src-container">

<pre><code class="python" >    def takewhile(predicate, iterable):
        for x in iterable:
            if predicate(x):
                yield x
            else:
                break
</code></pre>
</div></li>

</ul>

</section>
<section id="slide-7-9">
<h3 id="7-9"><span class="section-number-3">7.9.</span> <code>tee</code></h3>
<ul>
<li>Deli dati iterabilni objekat na više.</li>

<li>Ekvivalentno sa:</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >def tee(iterable, n=2):
    it = iter(iterable)
    deques = [collections.deque() for i in range(n)]
    def gen(mydeque):
        while True:
            if not mydeque:             # ako je lokalni dek prazan...
                try:
                    newval = next(it)   # preuzmi novu vrednosti i...
                except StopIteration:
                    return
                for d in deques:        # dodaj ih na sve dekove.
                    d.append(newval)
            yield mydeque.popleft()
    return tuple(gen(d) for d in deques)
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-8">
<h2 id="8"><span class="section-number-2">8.</span> <code>collections</code> - high-performance container datatypes</h2>
<div class="outline-text-2" id="text-8">
</div>
</section>
<section id="slide-8-1">
<h3 id="8-1"><span class="section-number-3">8.1.</span> OrderedDict</h3>
<ul>
<li>Nasleđuje <code>dict</code> i dodaje osobinu uređenosti. Iteracija vraća ključeve u
redosledu u kom su dodavani u kolekciju.</li>
<li>Dodaje metodu <code>move_to_end(key, last=True)</code> koja postojeći ključ pomera na
kraj kolekcije.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; d = OrderedDict.fromkeys('abcde')
&gt;&gt;&gt; d.move_to_end('b')
&gt;&gt;&gt; ''.join(d.keys())
'acdeb'
&gt;&gt;&gt; d.move_to_end('b', last=False)
&gt;&gt;&gt; ''.join(d.keys())
'bacde'

&gt;&gt;&gt; # nesortirani rečnik
&gt;&gt;&gt; d = {'banana': 3, 'apple': 4, 'pear': 1, 'orange': 2}

&gt;&gt;&gt; # rečnik sortiran po zatakom ključu
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: t[0]))
OrderedDict([('apple', 4), ('banana', 3), ('orange', 2), ('pear', 1)])

&gt;&gt;&gt; # rečnik sortiran po vrednosti
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: t[1]))
OrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)])

&gt;&gt;&gt; # rečnik sortiran po dužini ključa
&gt;&gt;&gt; OrderedDict(sorted(d.items(), key=lambda t: len(t[0])))
OrderedDict([('pear', 1), ('apple', 4), ('orange', 2), ('banana', 3)])
</code></pre>
</div>

</section>
<section id="slide-8-2">
<h3 id="8-2"><span class="section-number-3">8.2.</span> namedtuple</h3>
<ul>
<li>N-torke slične tipu <code>tuple</code> ali sa mogućnošću pristupa poljima po imenu kao
kod atributa objekta.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; # Basic example
&gt;&gt;&gt; Point = namedtuple('Point', ['x', 'y'])
&gt;&gt;&gt; p = Point(11, y=22)     # instantiate with positional or keyword arguments
&gt;&gt;&gt; p[0] + p[1]             # indexable like the plain tuple (11, 22)
33
&gt;&gt;&gt; x, y = p                # unpack like a regular tuple
&gt;&gt;&gt; x, y
(11, 22)
&gt;&gt;&gt; p.x + p.y               # fields also accessible by name
33
&gt;&gt;&gt; p                       # readable __repr__ with a name=value style
Point(x=11, y=22)
</code></pre>
</div>

</section>
<section id="slide-8-3">
<h3 id="8-3"><span class="section-number-3">8.3.</span> deque</h3>
<ul>
<li>Linearna struktura sa efikasnim <code>O(1)</code> ubacivanjem i uzimanjem elementa sa obe
strane.</li>
<li>Slično <code>list</code> tipu ali <code>list</code> tip ima složenost <code>O(n)</code> za ubacivanje i
izbacivanje elementa sa početka liste.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; from collections import deque
&gt;&gt;&gt; d = deque('ghi')                 # make a new deque with three items
&gt;&gt;&gt; for elem in d:                   # iterate over the deque's elements
...     print(elem.upper())
G
H
I

&gt;&gt;&gt; d.append('j')                    # add a new entry to the right side
&gt;&gt;&gt; d.appendleft('f')                # add a new entry to the left side
&gt;&gt;&gt; d                                # show the representation of the deque
deque(['f', 'g', 'h', 'i', 'j'])

&gt;&gt;&gt; d.pop()                          # return and remove the rightmost item
'j'
&gt;&gt;&gt; d.popleft()                      # return and remove the leftmost item
'f'
&gt;&gt;&gt; list(d)                          # list the contents of the deque
['g', 'h', 'i']
&gt;&gt;&gt; d[0]                             # peek at leftmost item
'g'
&gt;&gt;&gt; d[-1]                            # peek at rightmost item
'i'
</code></pre>
</div>

</section>
<section id="slide-8-4">
<h3 id="8-4"><span class="section-number-3">8.4.</span> Counter</h3>
<ul>
<li>Podklasa <code>dict</code> tipa za prebrojavanje objekata koji mogu da se <i>heširaju</i>.</li>
<li>Ključevi su objekti a vrednosti su njihov ukupan broj.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; c = Counter()                           # prazan Counter
&gt;&gt;&gt; c = Counter('gallahad')                 # Novi Counter iz iterable
&gt;&gt;&gt; c = Counter({'red': 4, 'blue': 2})      # Novi Counter iz rečnika
&gt;&gt;&gt; c = Counter(cats=4, dogs=8)             # Novi Counter upotrebom keyword arg.

&gt;&gt;&gt; c = Counter(['eggs', 'ham'])
&gt;&gt;&gt; c['bacon']                              # count of a missing element is zero
0

&gt;&gt;&gt; c = Counter(a=4, b=2, c=0, d=-2)
&gt;&gt;&gt; sorted(c.elements())
['a', 'a', 'a', 'a', 'b', 'b']

&gt;&gt;&gt; Counter('abracadabra').most_common(3)  
[('a', 5), ('r', 2), ('b', 2)]

&gt;&gt;&gt; c = Counter(a=4, b=2, c=0, d=-2)
&gt;&gt;&gt; d = Counter(a=1, b=2, c=3, d=4)
&gt;&gt;&gt; c.subtract(d)
&gt;&gt;&gt; c
Counter({'a': 3, 'b': 0, 'c': -3, 'd': -6})
</code></pre>
</div>

</section>
<section id="slide-8-5">
<h3 id="8-5"><span class="section-number-3">8.5.</span> defaultdict</h3>
<ul>
<li>Nasleđuje <code>dict</code> i omogućava kreiranje elementa sa podrazumevanom vrednošću
ukoliko se pokuša pristup nepostojećem elementu.</li>
<li>Kao parametar prima <code>default_factory</code> što mora biti <code>callable</code> koji će se
pozvati da kreira novi element.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; s = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]
&gt;&gt;&gt; d = defaultdict(list)
&gt;&gt;&gt; for k, v in s:
...     d[k].append(v)
...
&gt;&gt;&gt; sorted(d.items())
[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-9">
<h2 id="9"><span class="section-number-2">9.</span> Višestruko nasleđivanje i MRO</h2>
<div class="outline-text-2" id="text-9">
</div>
</section>
<section id="slide-9-1">
<h3 id="9-1"><span class="section-number-3">9.1.</span> Višestruko nasleđivanje</h3>
<ul>
<li>Python podržava višestruko nasleđivanje.</li>
<li>Problem razrešavanja metode/atributa iz nadklasa.</li>
<li><i>Diamond problem</i>.</li>
<li>Problem kod naivnog pretraživanja &ldquo;po dubini&rdquo;.</li>

</ul>


<div id="org6eabef6" class="figure">
<p><img src="./slike/Diamond_inheritance.svg" alt="Diamond_inheritance.svg" class="org-svg" style="height: 500px;" />
</p>
</div>

<p class="footer" style="clear: both;">
<a href="https://en.wikipedia.org/wiki/Multiple_inheritance" class="footer" style="clear: both;">Wikipedia: Multiple inheritance</a>
</p>

</section>
<section id="slide-9-2">
<h3 id="9-2"><span class="section-number-3">9.2.</span> <i>Method Resolution Order</i> (MRO)</h3>
<ul>
<li>Mehanizam/algoritam za razrešavanje u kontekstu višestrukog nasleđivanja</li>
<li>C3 linearizacija</li>
<li>Programski jezik <i>Dylan</i></li>
<li>Dva pravila:
<ul>
<li>Podklase se pretražuju pre nadklasa</li>
<li>Pretražuju se u redosledu navođenja</li>

</ul></li>
<li>Za primer sa prethodnog slajda: <code>D B C A</code></li>

</ul>

</section>
<section id="slide-9-3">
<h3 id="9-3"><span class="section-number-3">9.3.</span> <code>super</code></h3>
<ul>
<li>Dinamički određuje metodu/atribut na osnovu MRO.</li>
<li>Klase koje koriste višestruko nasleđivanje treba da se pišu na određeni način.</li>
<li>Obavezno koristiti <code>super</code> umesto direktnog navođenja klase.</li>

</ul>

</section>
<section id="slide-9-4">
<h3 id="9-4"><span class="section-number-3">9.4.</span> <code>super</code></h3>
<div class="org-src-container">

<pre><code class="python" >class LoggingDict(dict):
    def __setitem__(self, key, value):
        logging.info('Setting %r to %r' % (key, value))
        super().__setitem__(key, value)
</code></pre>
</div>

<div class="org-src-container">

<pre><code class="python" >class LoggingOD(LoggingDict, collections.OrderedDict):
    pass
</code></pre>
</div>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; pprint(LoggingOD.mro())
(&lt;class '__main__.LoggingOD'&gt;,
 &lt;class '__main__.LoggingDict'&gt;,
 &lt;class 'collections.OrderedDict'&gt;,
 &lt;class 'dict'&gt;,
 &lt;class 'object'&gt;)
</code></pre>
</div>

<p>
<code>OrderedDict</code> je ispred <code>dict</code> pa će <code>super</code> pozvati <code>OrderedDict.__setitem__</code>.
</p>

<p class="footer">
<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" class="footer">Raymond Hettinger:  Python’s super() considered super!</a>
</p>

</section>
<section id="slide-9-5">
<h3 id="9-5"><span class="section-number-3">9.5.</span> Parametri metoda</h3>
<ul>
<li>Situacija u kojoj signature metoda nisu iste.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >class Shape:
    def __init__(self, shapename, **kwds):
        self.shapename = shapename
        super().__init__(**kwds)        

class ColoredShape(Shape):
    def __init__(self, color, **kwds):
        self.color = color
        super().__init__(**kwds)

cs = ColoredShape(color='red', shapename='circle')
</code></pre>
</div>

<p class="footer">
<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" class="footer">Raymond Hettinger:  Python’s super() considered super!</a>
</p>

</section>
<section id="slide-9-6">
<h3 id="9-6"><span class="section-number-3">9.6.</span> Pretraga metoda</h3>
<ul>
<li>Obratiti pažnju da <code>super</code> poziv traži metodu uz MRO lanac.</li>
<li>Što znači da metoda mora postojati u nadklasi ili će doći do pojave izuzetka.</li>
<li>Kod primera sa konstruktorom <code>__init__</code> metoda postoji i u <code>object</code> korenskoj
klasi. Izuzetak se može pojaviti ukoliko nismo iscrpeli sve parametre u
<code>**kwds</code> što je svakako greška.</li>

</ul>

</section>
<section id="slide-9-7">
<h3 id="9-7"><span class="section-number-3">9.7.</span> Pretraga metoda</h3>
<ul>
<li>Ukoliko metoda ne postoji u korenskoj <code>object</code> klasi najbolje je kreirati
koren naše hijerarhije sa datom metodom.</li>
<li>Ova korenska metoda biće kraj pretrage.</li>
<li>Dodatno možemo osigurati da klase niz MRO lanac slučajno ne implementiraju
ciljnu metodu.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >class Root:
    def draw(self):
        # the delegation chain stops here
        assert not hasattr(super(), 'draw')

class Shape(Root):
    def __init__(self, shapename, **kwds):
        self.shapename = shapename
        super().__init__(**kwds)
    def draw(self):
        print('Drawing.  Setting shape to:', self.shapename)
        super().draw()

class ColoredShape(Shape):
    def __init__(self, color, **kwds):
        self.color = color
        super().__init__(**kwds)
    def draw(self):
        print('Drawing.  Setting color to:', self.color)
        super().draw()

cs = ColoredShape(color='blue', shapename='square')
cs.draw()
</code></pre>
</div>

<p class="footer">
<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" class="footer">Raymond Hettinger:  Python’s super() considered super!</a>
</p>

</section>
<section id="slide-9-8">
<h3 id="9-8"><span class="section-number-3">9.8.</span> Upotreba klasa koje nisu dizajnirane za višestruko nasleđivanje</h3>
<div class="org-src-container">

<pre><code class="python" >class Moveable:

    def __init__(self, x, y):
        self.x = x
        self.y = y

    def draw(self):
        print('Drawing at position:', self.x, self.y)
</code></pre>
</div>

<p class="footer">
<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" class="footer">Raymond Hettinger:  Python’s super() considered super!</a>
</p>

</section>
<section id="slide-9-9">
<h3 id="9-9"><span class="section-number-3">9.9.</span> Upotreba klasa koje nisu dizajnirane za višestruko nasleđivanje</h3>
<div class="org-src-container">

<pre><code class="python" >class MoveableAdapter(Root):

    def __init__(self, x, y, **kwds):
        self.movable = Moveable(x, y)
        super().__init__(**kwds)

    def draw(self):
        self.movable.draw()
        super().draw()

class MovableColoredShape(ColoredShape, MoveableAdapter):
    pass

MovableColoredShape(color='red', shapename='triangle',
                    x=10, y=20).draw()
</code></pre>
</div>

<p class="footer">
<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" class="footer">Raymond Hettinger:  Python’s super() considered super!</a>
</p>

</section>
</section>
<section>
<section id="slide-10">
<h2 id="10"><span class="section-number-2">10.</span> async/await</h2>
<div class="outline-text-2" id="text-10">
</div>
</section>
<section id="slide-10-1">
<h3 id="10-1"><span class="section-number-3">10.1.</span> Asinhrono programiranje</h3>
<ul>
<li>Klasično sekvencijalno izvršavanje podrazumeva da je svaka instrukcija
blokirajuća pa i I/O.</li>
<li>Gubimo dragoceno vreme dok čekamo na npr. završetak mrežnog zahteva ili
učitavanje podataka sa diska.</li>
<li>Kod asynhronog programiranja registrujemo tzv. <i>callback</i> funkcije koje se
izvršavaju kada su podaci zahtevani I/O pozivom spremni.</li>

</ul>

</section>
<section id="slide-10-2">
<h3 id="10-2"><span class="section-number-3">10.2.</span> Coroutines</h3>
<blockquote>
<p>
Coroutines are computer program components that generalize subroutines for
non-preemptive multitasking, by allowing execution to be suspended and resumed.
Coroutines are well-suited for implementing familiar program components such as
cooperative tasks, exceptions, event loops, iterators, infinite lists and pipes.
</p>
</blockquote>

<p class="footer">
<a href="https://en.wikipedia.org/wiki/Coroutine" class="footer">From Wikipedia, the free encyclopedia</a> 
</p>

</section>
<section id="slide-10-3">
<h3 id="10-3"><span class="section-number-3">10.3.</span> Coroutines in Python</h3>
<div class="org-src-container">

<pre><code class="python" >  def jumping_range(up_to):
      """Generator for the sequence of integers from 0 to up_to, exclusive.

      Sending a value into the generator will shift the sequence by that amount.
      """
      index = 0
      while index &lt; up_to:
          jump = yield index
          if jump is None:
              jump = 1
          index += jump


  if __name__ == '__main__':
      iterator = jumping_range(5)
      print(next(iterator))  # 0
      print(iterator.send(2))  # 2
      print(next(iterator))  # 3
      print(iterator.send(-1))  # 2
      for x in iterator:
          print(x)  # 3, 4

</code></pre>
</div>

<p class="footer">
<a href="https://snarky.ca/how-the-heck-does-async-await-work-in-python-3-5/" class="footer">How the heck does async/await work in Python 3.5?</a> 
</p>

</section>
<section id="slide-10-4">
<h3 id="10-4"><span class="section-number-3">10.4.</span> <code>yield from</code></h3>
<ul>
<li>Omogućava ulančavanje generatora/korutina.</li>
<li>Implementacija <i>producer-consumer</i> i <i>pipes</i> obrazaca.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >  def lazy_range(up_to):
      """Generator to return the sequence of integers from 0 to up_to, exclusive."""
      index = 0
      def gratuitous_refactor():
          nonlocal index
          while index &lt; up_to:
              yield index
              index += 1
      yield from gratuitous_refactor()
</code></pre>
</div>

<p class="footer">
<a href="https://snarky.ca/how-the-heck-does-async-await-work-in-python-3-5/" class="footer">How the heck does async/await work in Python 3.5?</a> 
</p>

</section>
<section id="slide-10-5">
<h3 id="10-5"><span class="section-number-3">10.5.</span> <i>Event loop</i></h3>
<blockquote>
<p>
In computer science, the event loop, message dispatcher, message loop, message
pump, or run loop is a programming construct that waits for and dispatches
events or messages in a program. It works by making a request to some internal
or external &ldquo;event provider&rdquo; (that generally blocks the request until an event
has arrived), and then it calls the relevant event handler (&ldquo;dispatches the
event&rdquo;).
</p>
</blockquote>

<p class="footer">
<a href="https://en.wikipedia.org/wiki/Event_loop" class="footer">From Wikipedia, the free encyclopedia</a> 
</p>

</section>
<section id="slide-10-6">
<h3 id="10-6"><span class="section-number-3">10.6.</span> Async kod sa <code>time.sleep(1)</code></h3>
<div class="org-src-container">

<pre id="time-sleep"><code class="python" >import asyncio
import time
from datetime import datetime

async def custom_sleep():
    print('SLEEP', datetime.now())
    time.sleep(1)

async def factorial(name, number):
    f = 1
    for i in range(2, number+1):
        print('Task {}: Compute factorial({})'.format(name, i))
        await custom_sleep()
        f *= i
    print('Task {}: factorial({}) is {}n'.format(name, number, f))


start = time.time()
loop = asyncio.new_event_loop()
asyncio.set_event_loop(loop)

tasks = [
    asyncio.ensure_future(factorial("A", 3)),
    asyncio.ensure_future(factorial("B", 4)),
]
loop.run_until_complete(asyncio.wait(tasks))
loop.close()

end = time.time()
print("Total time: {}".format(end - start))
</code></pre>
</div>

<p class="footer">
<a href="https://djangostars.com/blog/asynchronous-programming-in-python-asyncio/" class="footer">Python Asyncio Tutorial. Asynchronous Programming in Python</a>
</p>

</section>
<section id="slide-10-7">
<h3 id="10-7"><span class="section-number-3">10.7.</span> Async kod sa <code>time.sleep(1)</code> - rezultati</h3>
<pre class="example" id="org4017004">
  Task A: Compute factorial(2)
  SLEEP 2022-10-26 16:02:51.591313
  Task A: Compute factorial(3)
  SLEEP 2022-10-26 16:02:52.592472
  Task A: factorial(3) is 6n
  Task B: Compute factorial(2)
  SLEEP 2022-10-26 16:02:53.593721
  Task B: Compute factorial(3)
  SLEEP 2022-10-26 16:02:54.594089
  Task B: Compute factorial(4)
  SLEEP 2022-10-26 16:02:55.595270
  Task B: factorial(4) is 24n
  Total time: 5.006118059158325
</pre>

<p>
Vidimo da se prvo izvršio <i>Task A</i> pa onda <i>Task B</i> odnosno <code>time.sleep()</code>
poziv nije oslobodio <i>Event Loop</i>
</p>

</section>
<section id="slide-10-8">
<h3 id="10-8"><span class="section-number-3">10.8.</span> Async kod sa <code>asyncio.sleep(1)</code></h3>
<div class="org-src-container">

<pre id="async-sleep"><code class="python" >import asyncio
import time
from datetime import datetime

async def custom_sleep():
    print('SLEEP {}n'.format(datetime.now()))
    await asyncio.sleep(1)

async def factorial(name, number):
    f = 1
    for i in range(2, number+1):
        print('Task {}: Compute factorial({})'.format(name, i))
        await custom_sleep()
        f *= i
    print('Task {}: factorial({}) is {}n'.format(name, number, f))

start = time.time()
loop = asyncio.new_event_loop()
asyncio.set_event_loop(loop)

tasks = [
    asyncio.ensure_future(factorial("A", 3)),
    asyncio.ensure_future(factorial("B", 4)),
]
loop.run_until_complete(asyncio.wait(tasks))
loop.close()

end = time.time()
print("Total time: {}".format(end - start))
</code></pre>
</div>

<p class="footer">
<a href="https://djangostars.com/blog/asynchronous-programming-in-python-asyncio/" class="footer">Python Asyncio Tutorial. Asynchronous Programming in Python</a>
</p>

</section>
<section id="slide-10-9">
<h3 id="10-9"><span class="section-number-3">10.9.</span> Async kod sa <code>asyncio.sleep(1)</code> - rezultati</h3>
<pre class="example" id="orgfffa98f">
  Task A: Compute factorial(2)
  SLEEP 2022-10-26 16:03:33.711905n
  Task B: Compute factorial(2)
  SLEEP 2022-10-26 16:03:33.711931n
  Task A: Compute factorial(3)
  SLEEP 2022-10-26 16:03:34.713288n
  Task B: Compute factorial(3)
  SLEEP 2022-10-26 16:03:34.713412n
  Task A: factorial(3) is 6n
  Task B: Compute factorial(4)
  SLEEP 2022-10-26 16:03:35.714253n
  Task B: factorial(4) is 24n
  Total time: 3.0045108795166016
</pre>

<p>
U ovom slučaju vidimo da poziv <code>await asyncio.sleep(1)</code> oslobađa <i>Even Loop</i> i
zadaci se izvršavaju naizmenično
</p>

</section>
<section id="slide-10-10">
<h3 id="10-10"><span class="section-number-3">10.10.</span> Za dalje čitanje</h3>
<ul>
<li><a href="https://docs.python.org/3/library/asyncio-task.html">Python Docs: Coroutines and Tasks</a></li>
<li><a href="http://www.dabeaz.com/coroutines/">A Curious Course on Coroutines and Concurrency</a></li>

</ul>

</section>
</section>
<section>
<section id="slide-11">
<h2 id="11"><span class="section-number-2">11.</span> Metaklase</h2>
<div class="outline-text-2" id="text-11">
</div>
</section>
<section id="slide-11-1">
<h3 id="11-1"><span class="section-number-3">11.1.</span> Metaklase</h3>
<ul>
<li>Python klase predstavljaju &ldquo;šablon&rdquo; za kreiranje objekata.</li>
<li>I same klase su objekti. Šta je njihov šablon? Ko je zadužen za njihovo
kreiranje?</li>
<li>Klase imaju svoje &ldquo;klase&rdquo; koje nazivamo metaklasama.</li>

</ul>
</section>
<section id="slide-11-2">
<h3 id="11-2"><span class="section-number-3">11.2.</span> Metaklase</h3>
<ul>
<li>Python ima podrazumevanu metaklasu <code>type</code> koju interpreter koristi kada naiđe
na definiciju klase.</li>
<li><code>type</code> klasa je svoj sopstveni tip</li>
<li>Podrazumevanu klasu možemo promeniti i time uticati na kreiranje klase.</li>
<li>Pri kreiranju metaklase nasleđujemo <code>type</code></li>
<li>Kao što za instanciranje objekta Python poziva klasu, za kreiranje klase
poziva metaklasu.</li>
<li>Pojednostavljeno gledano <code>class</code> iskaz možemo smatrati lepšom sintaksom
(<i>Syntactic sugar</i>) za poziv <code>type</code> ili neke druge metaklase.</li>

</ul>

</section>
<section id="slide-11-3">
<h3 id="11-3"><span class="section-number-3">11.3.</span> <code>type</code></h3>
<ul>
<li><code>type</code> može da se koristi i kao funkcija koja vraća tip nekog objekta.</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; class Foobar:
...     pass
...
&gt;&gt;&gt; type(Foobar)
&lt;class 'type'&gt;
&gt;&gt;&gt; foo = Foobar()
&gt;&gt;&gt; type(foo)
&lt;class '__main__.Foobar'&gt;

&gt;&gt;&gt; isinstance(foo, Foobar)
True
&gt;&gt;&gt; isinstance(Foobar, type)
True
</code></pre>
</div>

<p class="footer">
<a href="https://blog.ionelmc.ro/2015/02/09/understanding-python-metaclasses/" class="footer">Ionel Cristian Mărieș: Understanding Python metaclasses</a> 
</p>

</section>
<section id="slide-11-4">
<h3 id="11-4"><span class="section-number-3">11.4.</span> Ili predstavljeno dijagramom</h3>

<div id="org5b65ef8" class="figure">
<p><img src="./slike/metaclass.png" alt="metaclass.png" />
</p>
</div>

<p class="footer">
<a href="https://blog.ionelmc.ro/2015/02/09/understanding-python-metaclasses/" class="footer">Ionel Cristian Mărieș: Understanding Python metaclasses</a> 
</p>

</section>
<section id="slide-11-5">
<h3 id="11-5"><span class="section-number-3">11.5.</span> Kreiranje klase sa <code>type</code></h3>
<div class="org-src-container">

<pre><code class="python" >MyClass = type('MyClass', (object,), {'a':5})
print(MyClass.a)
print(type(MyClass))
</code></pre>
</div>

<pre class="example">
5
&lt;class 'type'&gt;
</pre>


<div class="org-src-container">

<pre><code class="python" >MyClass2 = type('MyClass2', (MyClass,), {'b': True})
print(type(MyClass2))
print(dir(MyClass2))
print(MyClass2.__mro__)

</code></pre>
</div>

<pre class="example">
&lt;class 'type'&gt;
['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'a', 'b']
(&lt;class '__main__.MyClass2'&gt;, &lt;class '__main__.MyClass'&gt;, &lt;class 'object'&gt;)
</pre>

</section>
<section id="slide-11-6">
<h3 id="11-6"><span class="section-number-3">11.6.</span> Korisnička metaklasa</h3>
<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; class Meta(type):
...     pass

&gt;&gt;&gt; class Complex(metaclass=Meta):
...     pass
&gt;&gt;&gt; type(Complex)
&lt;class '__main__.Meta'&gt;
</code></pre>
</div>

</section>
<section id="slide-11-7">
<h3 id="11-7"><span class="section-number-3">11.7.</span> Specijalne metode</h3>
<ul>
<li><code>__new__</code> - konstruktor objekta</li>
<li><code>__init__</code> - inicijalizator</li>

</ul>

</section>
<section id="slide-11-8">
<h3 id="11-8"><span class="section-number-3">11.8.</span> Za dalje čitanje</h3>
<ul>
<li><a href="https://realpython.com/python-metaclasses/">Python Metaclasses</a></li>

</ul>
</section>
</section>
</div>
</div>
<script src="../../../s/reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c/t',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: true,
overview: true,
width: 1400,
height: 1000,
minScale: 0.30,
maxScale: 4.00,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'slide', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
{src: '../../../s/reveal.js/../reveal-plugins/menu/menu.js'},
{src: '../../../s/reveal.js/../reveal-plugins/chalkboard/chalkboard.js'},
 { src: '../../../s/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: '../../../s/reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }]

,keyboard: {67: function() { RevealChalkboard.toggleNotesCanvas() },	66: function() { RevealChalkboard.toggleChalkboard() },	46: function() { RevealChalkboard.clear() },	8: function() { RevealChalkboard.reset() },	68: function() { RevealChalkboard.download() },	},});
</script>
</body>
</html>
